{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "## üéØ Azure Arc Benefits Dashboard\n\nTrack and maximize your Azure Arc-enabled server capabilities across subscriptions."
      },
      "name": "title"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "defender-cost",
            "version": "KqlParameterItem/1.0",
            "name": "DefenderCost",
            "label": "Defender for Cloud Cost",
            "type": 1,
            "value": "450"
          },
          {
            "id": "updatemanager-cost",
            "version": "KqlParameterItem/1.0",
            "name": "UpdateManagerCost",
            "label": "Update Manager Cost",
            "type": 1,
            "value": "400"
          },
          {
            "id": "guestconfig-cost",
            "version": "KqlParameterItem/1.0",
            "name": "GuestConfigCost",
            "label": "Guest Configuration Cost",
            "type": 1,
            "value": "350"
          },
          {
            "id": "inventory-cost",
            "version": "KqlParameterItem/1.0",
            "name": "InventoryCost",
            "label": "Inventory & Tracking Cost",
            "type": 1,
            "value": "300"
          },
          {
            "id": "bestpractice-cost",
            "version": "KqlParameterItem/1.0",
            "name": "BestPracticeCost",
            "label": "Best Practice Assessment Cost",
            "type": 1,
            "value": "250"
          },
          {
            "id": "hotpatching-cost",
            "version": "KqlParameterItem/1.0",
            "name": "HotpatchingCost",
            "label": "Hotpatching Cost",
            "type": 1,
            "value": "225"
          },
          {
            "id": "monitoring-cost",
            "version": "KqlParameterItem/1.0",
            "name": "MonitoringCost",
            "label": "Monitoring & Insights Cost",
            "type": 1,
            "value": "200"
          },
          {
            "id": "tagging-cost",
            "version": "KqlParameterItem/1.0",
            "name": "TaggingCost",
            "label": "Resource Tagging Cost",
            "type": 1,
            "value": "150"
          },
          {
            "id": "admincenter-cost",
            "version": "KqlParameterItem/1.0",
            "name": "AdminCenterCost",
            "label": "Windows Admin Center Cost",
            "type": 1,
            "value": "125"
          }
        ],
        "style": "above",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "name": "cost-parameters"
    },
    {
      "type": 1,
      "content": {
        "json": "üí° **Cost Parameters:** The values above represent estimated annual labor/operational costs per server for managing each Arc capability. These are customizable estimates used to calculate potential savings from unconfigured servers. Edit these values to match your organization's costs.\n\nüìö [Learn more about Windows Server software assurance benefits and pricing](https://learn.microsoft.com/en-us/azure/azure-arc/servers/windows-server-management-overview)"
      },
      "name": "cost-note"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "subscription-filter",
            "version": "KqlParameterItem/1.0",
            "name": "Subscriptions",
            "type": 6,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "Resources\r\n| where type =~ 'microsoft.hybridcompute/machines'\r\n| summarize Count = count() by subscriptionId\r\n| order by Count desc\r\n| extend Rank = row_number()\r\n| project value = subscriptionId, label = subscriptionId, selected = true",
            "crossComponentResources": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
              "value::all"
            ]
          }
        ],
        "style": "pills",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "name": "parameters"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "selected-tab-param",
            "name": "selectedTab",
            "type": 1,
            "value": "overview"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "conditionalVisibility": {
        "parameterName": "alwaysHide",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "tab-parameter"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "overview-tab",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "üìä Overview",
            "subTarget": "overview",
            "preText": "",
            "style": "link"
          },
          {
            "id": "updatemanager-tab",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Update Manager",
            "subTarget": "updatemanager",
            "style": "link"
          },
          {
            "id": "defender-tab",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Defender",
            "subTarget": "defender",
            "style": "link"
          },
          {
            "id": "inventory-tab",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Inventory",
            "subTarget": "inventory",
            "style": "link"
          },
          {
            "id": "guestconfig-tab",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Guest Config",
            "subTarget": "guestconfig",
            "style": "link"
          },
          {
            "id": "bestpractice-tab",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Best Practice",
            "subTarget": "bestpractice",
            "style": "link"
          },
          {
            "id": "tagging-tab",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Tagging",
            "subTarget": "tagging",
            "style": "link"
          },
          {
            "id": "monitoring-tab",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Monitoring",
            "subTarget": "monitoring",
            "style": "link"
          },
          {
            "id": "admincenter-tab",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Admin Center",
            "subTarget": "admincenter",
            "style": "link"
          },
          {
            "id": "hotpatching-tab",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Hotpatching",
            "subTarget": "hotpatching",
            "style": "link"
          }
        ]
      },
      "name": "service-tabs"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "// Join for extensions and guest configuration\r\nresources\r\n| where type == \"microsoft.hybridcompute/machines\"\r\n| extend \r\n    hasUpdateManager = isnotnull(properties.osProfile.windowsConfiguration.patchSettings.assessmentMode) or isnotnull(properties.osProfile.linuxConfiguration.patchSettings.assessmentMode),\r\n    hasTags = isnotnull(tags) and tostring(tags) != \"{}\",\r\n    isWS2025 = properties.osVersion contains \"2025\" or properties.osVersion contains \"10.0.26100\",\r\n    hasHotpatch = tobool(properties.osProfile.windowsConfiguration.patchSettings.enableHotpatching),\r\n    machineId = tolower(id)\r\n| join kind=leftouter (\r\n    resources\r\n    | where type == \"microsoft.hybridcompute/machines/extensions\"\r\n    | extend \r\n        machineId = tolower(substring(id, 0, indexof(id, \"/extensions/\"))),\r\n        extType = tolower(tostring(properties.type)),\r\n        extPublisher = tolower(tostring(properties.publisher)),\r\n        extName = tolower(name)\r\n    | summarize extensions = make_set(strcat(extType, \"|\", extPublisher, \"|\", extName)) by machineId\r\n) on machineId\r\n| join kind=leftouter (\r\n    guestconfigurationresources\r\n    | where type =~ 'microsoft.guestconfiguration/guestconfigurationassignments'\r\n    | parse id with machineId '/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/' assignmentName\r\n    | project machineId = tolower(machineId)\r\n    | distinct machineId\r\n    | extend hasGuestConfigAssignment = true\r\n) on machineId\r\n| extend \r\n    hasDefender = isnotnull(extensions) and (extensions has \"mde\" or extensions has \"microsoft.azure.security\"),\r\n    hasInventory = isnotnull(extensions) and (extensions has \"changetracking\" or extensions has \"microsoftmonitoringagent\"),\r\n    hasMonitoring = isnotnull(extensions) and (extensions has \"azuremonitorwindowsagent\" or extensions has \"azuremonitorlinuxagent\" or extensions has \"loganalytics\" or extensions has \"omsagent\"),\r\n    hasGuestConfig = hasGuestConfigAssignment == true,\r\n    hasBestPractice = isnotnull(extensions) and (extensions has \"windowsserverassessment\" or extensions has \"assessmentplatform\"),\r\n    hasAdminCenter = isnotnull(extensions) and extensions has \"admincenter\"\r\n| summarize \r\n    TotalServers = count(),\r\n    UpdateManagerConfigured = countif(hasUpdateManager),\r\n    TaggingConfigured = countif(hasTags),\r\n    HotpatchConfigured = countif(isWS2025 and hasHotpatch),\r\n    HotpatchTotal = countif(isWS2025),\r\n    DefenderConfigured = countif(hasDefender),\r\n    InventoryConfigured = countif(hasInventory),\r\n    MonitoringConfigured = countif(hasMonitoring),\r\n    GuestConfigConfigured = countif(hasGuestConfig),\r\n    BestPracticeConfigured = countif(hasBestPractice),\r\n    AdminCenterConfigured = countif(hasAdminCenter)\r\n| project \r\n    TotalServers,\r\n    services = pack_array(\r\n        pack(\"name\", \"Azure Arc-enabled Servers - Update Manager\", \"category\", \"Security & Compliance\", \"cost\", {UpdateManagerCost}, \"configured\", UpdateManagerConfigured, \"total\", TotalServers),\r\n        pack(\"name\", \"Arc-enabled Servers - Resource Tagging\", \"category\", \"Deployment & Management\", \"cost\", {TaggingCost}, \"configured\", TaggingConfigured, \"total\", TotalServers),\r\n        pack(\"name\", \"Arc-enabled Servers - Hotpatching (WS2025)\", \"category\", \"Deployment & Management\", \"cost\", {HotpatchingCost}, \"configured\", HotpatchConfigured, \"total\", HotpatchTotal),\r\n        pack(\"name\", \"Arc-enabled Servers - Microsoft Defender for Cloud\", \"category\", \"Security & Compliance\", \"cost\", {DefenderCost}, \"configured\", DefenderConfigured, \"total\", TotalServers),\r\n        pack(\"name\", \"Azure Arc-enabled Servers - Inventory & Tracking\", \"category\", \"Security & Compliance\", \"cost\", {InventoryCost}, \"configured\", InventoryConfigured, \"total\", TotalServers),\r\n        pack(\"name\", \"Arc-enabled Servers - Monitoring & Insights\", \"category\", \"Deployment & Management\", \"cost\", {MonitoringCost}, \"configured\", MonitoringConfigured, \"total\", TotalServers),\r\n        pack(\"name\", \"Azure Arc-enabled Servers - Guest Configuration\", \"category\", \"Security & Compliance\", \"cost\", {GuestConfigCost}, \"configured\", GuestConfigConfigured, \"total\", TotalServers),\r\n        pack(\"name\", \"Arc-enabled Servers - Best Practice Assessment\", \"category\", \"Security & Compliance\", \"cost\", {BestPracticeCost}, \"configured\", BestPracticeConfigured, \"total\", TotalServers),\r\n        pack(\"name\", \"Arc-enabled Servers - Windows Admin Center\", \"category\", \"Deployment & Management\", \"cost\", {AdminCenterCost}, \"configured\", AdminCenterConfigured, \"total\", TotalServers)\r\n    )\r\n| mv-expand service = services\r\n| extend \r\n    ServiceName = tostring(service.name),\r\n    Category = tostring(service.category),\r\n    Cost = toint(service.cost),\r\n    Configured = tolong(service.configured),\r\n    Total = tolong(service.total)\r\n| extend \r\n    Unconfigured = Total - Configured,\r\n    Percent = round(todouble(Configured) * 100.0 / todouble(Total), 1)\r\n| extend Savings = todouble(Unconfigured * Cost)\r\n| extend Status = case(Percent >= 100.0, \"üü¢ Fully Configured\", Percent > 0.0, \"üü° Partially Configured\", \"üî¥ Not Configured\")\r\n| project ServiceName, Category, ConfiguredServers = Configured, UnconfiguredServers = Unconfigured, PercentConfigured = Percent, PotentialSavings = Savings, Status\r\n| order by PotentialSavings desc",
        "size": 0,
        "title": "üìä Arc Capabilities Summary - All Services",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{Subscriptions}"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "ConfiguredServers",
              "formatter": 4,
              "formatOptions": {
                "palette": "green"
              }
            },
            {
              "columnMatch": "UnconfiguredServers",
              "formatter": 4,
              "formatOptions": {
                "palette": "red"
              }
            },
            {
              "columnMatch": "PercentConfigured",
              "formatter": 8,
              "formatOptions": {
                "palette": "greenRed"
              },
              "numberFormat": {
                "unit": 1,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 0
                }
              }
            },
            {
              "columnMatch": "PotentialSavings",
              "formatter": 4,
              "formatOptions": {
                "palette": "blue",
                "customColumnWidthSetting": "20ch"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "currency",
                  "currency": "USD",
                  "maximumFractionDigits": 0
                }
              }
            }
          ],
          "hierarchySettings": {
            "treeType": 1,
            "groupBy": [
              "Category"
            ],
            "expandTopLevel": true
          }
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "overview"
      },
      "name": "benefits-summary"
    },
    {
      "type": 1,
      "content": {
        "json": "---\n\n### ÔøΩÔ∏è Update Manager - Server Details\n\nServers configured vs. unconfigured for Update Manager (automatic patch management)."
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "updatemanager"
      },
      "name": "update-manager-header"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type == \"microsoft.hybridcompute/machines\"\r\n| extend \r\n    hasUpdateManager = isnotnull(properties.osProfile.windowsConfiguration.patchSettings.assessmentMode) or isnotnull(properties.osProfile.linuxConfiguration.patchSettings.assessmentMode),\r\n    ConfigurationStatus = iff(\r\n        isnotnull(properties.osProfile.windowsConfiguration.patchSettings.assessmentMode) or isnotnull(properties.osProfile.linuxConfiguration.patchSettings.assessmentMode),\r\n        \"‚úÖ Configured\",\r\n        \"‚ùå Not Configured\"\r\n    )\r\n| project \r\n    ServerName = name,\r\n    ResourceGroup = resourceGroup,\r\n    Subscription = subscriptionId,\r\n    OSType = properties.osName,\r\n    Status = ConfigurationStatus,\r\n    Location = location\r\n| order by Status desc, ServerName asc",
        "size": 0,
        "title": "All Servers - Update Manager Status",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{Subscriptions}"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Status",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "Configured",
                    "representation": "green",
                    "text": "{0}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Not",
                    "representation": "redBright",
                    "text": "{0}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "gray",
                    "text": "{0}"
                  }
                ]
              }
            }
          ],
          "filter": true
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "updatemanager"
      },
      "name": "update-manager-details"
    },
    {
      "type": 1,
      "content": {
        "json": "---\n\n### üè∑Ô∏è Resource Tagging - Server Details\n\nServers with proper resource tagging configured."
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "tagging"
      },
      "name": "tagging-header"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type == \"microsoft.hybridcompute/machines\"\r\n| extend hasTags = isnotnull(tags) and tostring(tags) != \"{}\"\r\n| extend ConfigurationStatus = iff(hasTags, \"‚úÖ Configured\", \"‚ùå Not Configured\")\r\n| extend tagCount = array_length(todynamic(tags))\r\n| project \r\n    ServerName = name,\r\n    ResourceGroup = resourceGroup,\r\n    Subscription = subscriptionId,\r\n    TagCount = iff(isnotnull(tagCount), tagCount, 0),\r\n    Status = ConfigurationStatus,\r\n    Location = location\r\n| order by Status desc, ServerName asc",
        "size": 0,
        "title": "All Servers - Resource Tagging Status",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{Subscriptions}"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Status",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "Configured",
                    "representation": "green",
                    "text": "{0}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Not",
                    "representation": "redBright",
                    "text": "{0}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "gray",
                    "text": "{0}"
                  }
                ]
              }
            }
          ],
          "filter": true
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "tagging"
      },
      "name": "tagging-details"
    },
    {
      "type": 1,
      "content": {
        "json": "---\n\n### üî• Hotpatching - Server Details\n\nWindows Server 2025 machines with hotpatching enabled."
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "hotpatching"
      },
      "name": "hotpatching-header"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type == \"microsoft.hybridcompute/machines\"\r\n| extend isWS2025 = properties.osVersion contains \"2025\" or properties.osVersion contains \"10.0.26100\"\r\n| extend hasHotpatch = tobool(properties.osProfile.windowsConfiguration.patchSettings.enableHotpatching) == true\r\n| extend ConfigurationStatus = iff(isWS2025 and hasHotpatch, \"‚úÖ Configured\", iff(isWS2025, \"‚ùå Available but Not Configured\", \"N/A - Not WS2025\"))\r\n| project \r\n    ServerName = name,\r\n    ResourceGroup = resourceGroup,\r\n    Subscription = subscriptionId,\r\n    OSVersion = properties.osVersion,\r\n    Status = ConfigurationStatus,\r\n    Location = location\r\n| order by Status desc, ServerName asc",
        "size": 0,
        "title": "All Servers - Hotpatching Status",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{Subscriptions}"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Status",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "Configured",
                    "representation": "green",
                    "text": "{0}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Not Configured",
                    "representation": "redBright",
                    "text": "{0}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "gray",
                    "text": "{0}"
                  }
                ]
              }
            }
          ],
          "filter": true
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "hotpatching"
      },
      "name": "hotpatching-details"
    },
    {
      "type": 1,
      "content": {
        "json": "---\n\n### üõ°Ô∏è Defender for Cloud - Server Details\n\nServers with Microsoft Defender for Endpoint extension installed."
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "defender"
      },
      "name": "defender-header"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type == \"microsoft.hybridcompute/machines\"\r\n| extend machineId = tolower(id)\r\n| join kind=leftouter (\r\n    resources\r\n    | where type == \"microsoft.hybridcompute/machines/extensions\"\r\n    | where properties.type == \"MDE.Windows\" or properties.type == \"MDE.Linux\"\r\n    | extend machineId = tolower(substring(id, 0, indexof(id, '/extensions/')))\r\n    | summarize hasDefender = any(true) by machineId\r\n) on machineId\r\n| extend ConfigurationStatus = iff(hasDefender == true, \"‚úÖ Configured\", \"‚ùå Not Configured\")\r\n| project \r\n    ServerName = name,\r\n    ResourceGroup = resourceGroup,\r\n    Subscription = subscriptionId,\r\n    OSType = properties.osName,\r\n    Status = ConfigurationStatus,\r\n    Location = location\r\n| order by Status desc, ServerName asc",
        "size": 0,
        "title": "All Servers - Defender for Cloud Status",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{Subscriptions}"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Status",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "Configured",
                    "representation": "green",
                    "text": "{0}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Not",
                    "representation": "redBright",
                    "text": "{0}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "gray",
                    "text": "{0}"
                  }
                ]
              }
            }
          ],
          "filter": true
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "defender"
      },
      "name": "defender-details"
    },
    {
      "type": 1,
      "content": {
        "json": "---\n\n### üì¶ Inventory & Tracking - Server Details\n\nServers with Change Tracking extension installed."
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "inventory"
      },
      "name": "inventory-header"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type == \"microsoft.hybridcompute/machines\"\r\n| extend machineId = tolower(id)\r\n| join kind=leftouter (\r\n    resources\r\n    | where type == \"microsoft.hybridcompute/machines/extensions\"\r\n    | where properties.type == \"ChangeTracking-Windows\" or properties.type == \"ChangeTracking-Linux\"\r\n    | extend machineId = tolower(substring(id, 0, indexof(id, '/extensions/')))\r\n    | summarize hasInventory = any(true) by machineId\r\n) on machineId\r\n| extend ConfigurationStatus = iff(hasInventory == true, \"‚úÖ Configured\", \"‚ùå Not Configured\")\r\n| project \r\n    ServerName = name,\r\n    ResourceGroup = resourceGroup,\r\n    Subscription = subscriptionId,\r\n    OSType = properties.osName,\r\n    Status = ConfigurationStatus,\r\n    Location = location\r\n| order by Status desc, ServerName asc",
        "size": 0,
        "title": "All Servers - Inventory & Tracking Status",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{Subscriptions}"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Status",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "Configured",
                    "representation": "green",
                    "text": "{0}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Not",
                    "representation": "redBright",
                    "text": "{0}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "gray",
                    "text": "{0}"
                  }
                ]
              }
            }
          ],
          "filter": true
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "inventory"
      },
      "name": "inventory-details"
    },
    {
      "type": 1,
      "content": {
        "json": "---\n\n### üìä Monitoring & Insights - Server Details\n\nServers with Azure Monitor Agent extension installed."
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "monitoring"
      },
      "name": "monitoring-header"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type == \"microsoft.hybridcompute/machines\"\r\n| extend machineId = tolower(id)\r\n| join kind=leftouter (\r\n    resources\r\n    | where type == \"microsoft.hybridcompute/machines/extensions\"\r\n    | extend \r\n        machineId = tolower(substring(id, 0, indexof(id, '/extensions/'))),\r\n        extType = tolower(tostring(properties.type)),\r\n        extPublisher = tolower(tostring(properties.publisher)),\r\n        extName = tolower(name)\r\n    | where extType contains \"azuremonitor\" or extType contains \"loganalytics\" or extType contains \"omsagent\" or extPublisher contains \"microsoft.azure.monitor\"\r\n    | summarize hasMonitoring = any(true) by machineId\r\n) on machineId\r\n| extend ConfigurationStatus = iff(hasMonitoring == true, \"‚úÖ Configured\", \"‚ùå Not Configured\")\r\n| project \r\n    ServerName = name,\r\n    ResourceGroup = resourceGroup,\r\n    Subscription = subscriptionId,\r\n    OSType = properties.osName,\r\n    Status = ConfigurationStatus,\r\n    Location = location\r\n| order by Status desc, ServerName asc",
        "size": 0,
        "title": "All Servers - Monitoring & Insights Status",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{Subscriptions}"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Status",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "Configured",
                    "representation": "green",
                    "text": "{0}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Not",
                    "representation": "redBright",
                    "text": "{0}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "gray",
                    "text": "{0}"
                  }
                ]
              }
            }
          ],
          "filter": true
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "monitoring"
      },
      "name": "monitoring-details"
    },
    {
      "type": 1,
      "content": {
        "json": "---\n\n### ‚öôÔ∏è Guest Configuration - Server Details\n\nServers with Guest Configuration extension installed."
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "guestconfig"
      },
      "name": "guestconfig-header"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type =~ 'microsoft.hybridcompute/machines'\r\n| project machineId = tolower(id), ServerName = name, ResourceGroup = resourceGroup, Subscription = subscriptionId, OSType = properties.osName, Location = location\r\n| join kind=leftouter (\r\n    guestconfigurationresources\r\n    | where type =~ 'microsoft.guestconfiguration/guestconfigurationassignments'\r\n    | parse id with machineId '/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/' assignmentName\r\n    | project machineId = tolower(machineId)\r\n    | distinct machineId\r\n    | extend hasGuestConfig = true\r\n) on machineId\r\n| extend Status = iff(hasGuestConfig == true, \"‚úÖ Configured\", \"‚ùå Not Configured\")\r\n| project ServerName, ResourceGroup, Subscription, OSType, Status, Location\r\n| order by Status desc, ServerName asc",
        "size": 0,
        "title": "All Servers - Guest Configuration Status",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{Subscriptions}"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Status",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "Configured",
                    "representation": "green",
                    "text": "{0}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Not",
                    "representation": "redBright",
                    "text": "{0}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "gray",
                    "text": "{0}"
                  }
                ]
              }
            }
          ],
          "filter": true
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "guestconfig"
      },
      "name": "guestconfig-details"
    },
    {
      "type": 1,
      "content": {
        "json": "---\n\n### ‚úÖ Best Practice Assessment - Server Details\n\nServers with Best Practice Assessment extension installed."
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "bestpractice"
      },
      "name": "bestpractice-header"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type == \"microsoft.hybridcompute/machines\"\r\n| extend machineId = tolower(id)\r\n| join kind=leftouter (\r\n    resources\r\n    | where type == \"microsoft.hybridcompute/machines/extensions\"\r\n    | extend \r\n        machineId = tolower(substring(id, 0, indexof(id, '/extensions/'))),\r\n        extType = tolower(tostring(properties.type)),\r\n        extName = tolower(name)\r\n    | where extType contains \"windowsserverassessment\" or extType contains \"assessmentplatform\" or extName contains \"windowsserverassessment\" or extName contains \"assessmentplatform\"\r\n    | summarize hasBestPractice = any(true) by machineId\r\n) on machineId\r\n| extend ConfigurationStatus = iff(hasBestPractice == true, \"‚úÖ Configured\", \"‚ùå Not Configured\")\r\n| project \r\n    ServerName = name,\r\n    ResourceGroup = resourceGroup,\r\n    Subscription = subscriptionId,\r\n    OSType = properties.osName,\r\n    Status = ConfigurationStatus,\r\n    Location = location\r\n| order by Status desc, ServerName asc",
        "size": 0,
        "title": "All Servers - Best Practice Assessment Status",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{Subscriptions}"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Status",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "Configured",
                    "representation": "green",
                    "text": "{0}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Not",
                    "representation": "redBright",
                    "text": "{0}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "gray",
                    "text": "{0}"
                  }
                ]
              }
            }
          ],
          "filter": true
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "bestpractice"
      },
      "name": "bestpractice-details"
    },
    {
      "type": 1,
      "content": {
        "json": "---\n\n### üíª Windows Admin Center - Server Details\n\nServers with Windows Admin Center extension installed."
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "admincenter"
      },
      "name": "admincenter-header"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type == \"microsoft.hybridcompute/machines\"\r\n| extend machineId = tolower(id)\r\n| join kind=leftouter (\r\n    resources\r\n    | where type == \"microsoft.hybridcompute/machines/extensions\"\r\n    | where properties.type contains \"AdminCenter\"\r\n    | extend machineId = tolower(substring(id, 0, indexof(id, '/extensions/')))\r\n    | summarize hasAdminCenter = any(true) by machineId\r\n) on machineId\r\n| extend ConfigurationStatus = iff(hasAdminCenter == true, \"‚úÖ Configured\", \"‚ùå Not Configured\")\r\n| project \r\n    ServerName = name,\r\n    ResourceGroup = resourceGroup,\r\n    Subscription = subscriptionId,\r\n    OSType = properties.osName,\r\n    Status = ConfigurationStatus,\r\n    Location = location\r\n| order by Status desc, ServerName asc",
        "size": 0,
        "title": "All Servers - Windows Admin Center Status",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{Subscriptions}"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Status",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "Configured",
                    "representation": "green",
                    "text": "{0}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Not",
                    "representation": "redBright",
                    "text": "{0}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "gray",
                    "text": "{0}"
                  }
                ]
              }
            }
          ],
          "filter": true
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "admincenter"
      },
      "name": "admincenter-details"
    },
    {
      "type": 1,
      "content": {
        "json": "---\n\n### üìù Notes\n\n**To Edit Pricing:**\n1. Click \"Edit\" at the top of the workbook\n2. Scroll to the top and modify the cost parameter values (DefenderCost, UpdateManagerCost, etc.)\n3. Click \"Done Editing\" ‚Üí \"Save\""
      },
      "name": "notes"
    }
  ],
  "fallbackResourceIds": [
    "Azure Monitor"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}

